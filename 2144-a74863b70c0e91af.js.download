"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2144],{429:function(e,t,n){n.d(t,{$j:function(){return o},DU:function(){return u},Dz:function(){return a},L8:function(){return d},S8:function(){return r},ky:function(){return s},q$:function(){return l},xi:function(){return i}});let r=255,a=380,l=100,i=100,o=171,u=260,s=50,d="temp"},82144:function(e,t,n){function getCookie(e){let t=document.cookie.split(";");for(let n=0;n<t.length;n++){let r=t[n].trim();if(r.startsWith(e+"="))return r.substring(e.length+1)}return null}n.d(t,{yM:function(){return eB.yM},ED:function(){return eB.ED},xr:function(){return s},Dy:function(){return g},eN:function(){return m},B_:function(){return L},Tl:function(){return er},K8:function(){return x},D:function(){return E},iU:function(){return v},IK:function(){return I},MZ:function(){return O},L:function(){return $},_P:function(){return T},Bz:function(){return j},kx:function(){return c},mV:function(){return p},pf:function(){return B},rH:function(){return W},$h:function(){return V},u9:function(){return u},y6:function(){return G},E8:function(){return J},_B:function(){return Q},Vl:function(){return ee},os:function(){return eX},lq:function(){return y},Pj:function(){return A},zB:function(){return eE},Qr:function(){return getAbsoluteNodePosition},t1:function(){return getCenteredYPosition},ej:function(){return getCookie},gk:function(){return et},ap:function(){return en},CM:function(){return i},d5:function(){return ea},_J:function(){return ef},hz:function(){return d},Us:function(){return el},g5:function(){return ei},Jx:function(){return eo},$R:function(){return eb},DF:function(){return eu},Lo:function(){return es},jI:function(){return eg},iJ:function(){return em},Ud:function(){return isPathStep},iB:function(){return ey},es:function(){return eA},Li:function(){return eL},CF:function(){return ex},uQ:function(){return ed},pY:function(){return R},El:function(){return w},bW:function(){return eY},Xe:function(){return eN},Kg:function(){return f.K},_0:function(){return ev},Id:function(){return ep},PD:function(){return ez},xL:function(){return ec},qS:function(){return eF},sm:function(){return Z},dp:function(){return ek},$P:function(){return e_},Ke:function(){return eK},Ti:function(){return e$},S9:function(){return ej},m5:function(){return M.m},A:function(){return eI},QE:function(){return eC},yW:function(){return o},FX:function(){return eM},KO:function(){return H},JT:function(){return U},jc:function(){return eO},B9:function(){return eT},Yh:function(){return eB.Yh},rr:function(){return l},Hu:function(){return eH},nj:function(){return F},oT:function(){return eh},$N:function(){return eJ},pX:function(){return eW},DM:function(){return D},zO:function(){return q},yb:function(){return eq},Vj:function(){return uuid},kg:function(){return eQ},SN:function(){return e0},I2:function(){return eV},mq:function(){return eP}});let isPathStep=e=>"run"===e.type&&("EngineAPI"===e.app||"BranchingAPI"===e.app)&&"parallel_paths"===e.action;function getAbsoluteNodePosition(e,t){if(!e?.parentNode)return e?.position;let n=t.find(t=>t.id===e.parentNode);if(!n)throw Error(`Parent node ${e.parentNode} not found`);return{x:e.position.x+n.position.x,y:e.position.y+n.position.y}}var r=n(429);function getCenteredYPosition(e){let{nodePosition:t,nodeHeight:n,isPathNode:a}=e,l=a?r.q$:r.$j,i=t.y+(n||r.$j)/2;return i-l/2}function uuid(){let e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)});return e}var a=n(54337);let l=(0,a.cn)(null);l.debugLabel="tablesAtom";let i=(0,a.cn)(null);function asyncAtomWithStorage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asyncAtomWithStorage",n=(0,a.cn)(null),r=(0,a.cn)(t=>{let r=t(n);return null===r&&(r=e(t)),r},function(e,t,r){return t(n,r instanceof Function?r(e(this).value):r)});return r.debugLabel=t,r}i.debugLabel="interfacesAtom";let o=(0,a.cn)(null);o.debugLabel="sessionAtom";let u=(0,a.cn)(void 0),s=(0,a.cn)(null);s.debugLabel="accountAtom";let d=(0,a.cn)(e=>{let t=e(s),n=e(o),r=t?.plan_info?.allow_teams===!0,a=n?.email?.includes("gen_api.canvas");return r&&!a});d.debugLabel="isCollaborationModeAtom";let c=(0,a.cn)(null);c.debugLabel="chatbotsAppAtom";let p=asyncAtomWithStorage(async e=>{let t=e(u);if(!t)return[];try{let e=await fetch("/api/chatbots/v0/chatbots",{headers:{"trailing-slash-hack":"true"}}),t=await e.json();return t.data.map(e=>({...e,label:e.name}))}catch(e){return[]}},"chatbotsAsyncAtom");var f=n(71287);let g=(0,a.cn)(e=>{let t=e(f.K),n=t.map(e=>e.data?.actor).filter(e=>!!e&&!!e.label);return n.reduce((e,t)=>(e.some(e=>e.label===t.label)||e.push(t),e),[])});g.debugLabel="actorsAtom";let m=(0,a.cn)(null,async(e,t)=>{try{let n=await e(ec),r=e(ed);if(!n||!r)return{error:!1};let[a,l]=r.split(":"),i=await fetch(`/api/v1/projects/${n.id}/assets/`,{method:"POST",headers:{"trailing-slash-hack":"true","Content-Type":"application/json","x-csrftoken":getCookie("csrftoken")||""},body:JSON.stringify({asset_type:a,asset_id:l})});if(i.ok)return t(ed,null),t(ep),{error:!1};return console.error(`Failed to add asset to project ${n.id}:`,i.status,i.statusText),{error:!0}}catch(e){return console.error("Error adding asset to project:",e),{error:!0}}});m.debugLabel="addAssetToProjectSetterAtom";var b=n(48540),h=n(57808);let y=(0,a.cn)([]);y.debugLabel="edgesAtom";let A=(0,a.cn)(null);A.debugLabel="editingEdgeAtom";let L=(0,a.cn)(null,(e,t,n)=>{let r=e(y),a=r.some(e=>e.id===n.id);if(a)return null;{let e=[...r,{...n,markerEnd:{type:b.QZ.Arrow,strokeWidth:1.5,color:h.w.neutral500}}];return t(y,e),e}});L.debugLabel="addEdgeAtom";var S=n(39236);let w=(0,S.xu)(e=>{let t=(0,a.cn)(t=>{let n=t(f.K);return n.find(t=>{let{id:n}=t;return n===e})});return t.debugLabel=`nodeAtomFamily(${e})`,t}),x=(0,a.cn)(null,(e,t,n)=>{let{id:a,nodePartial:l}=n,i=e(f.K),o=e(y),u=e(w(a));if(!u)return{nodes:i,edges:o};let s=i,d=o,c=uuid(),p=getAbsoluteNodePosition(u,i),g={id:c,position:{x:p.x-r.Dz,y:getCenteredYPosition({nodePosition:p,nodeHeight:u.height,isPathNode:!1})},type:"default",selected:!0,...l,data:{label:"",...l?.data}},m={id:`${c}=>${u.id}`,source:c,target:u.id,markerEnd:{type:b.QZ.Arrow,strokeWidth:1.5,color:h.w.neutral500}},A=(0,b.xA)(g,i,o);return t(y,e=>{let t=e;return 1===A.length&&(t=t.map(e=>e.source===g.id?{...e,source:u.id}:e)),d=t=t.concat([m]),t}),t(f.K,e=>{let t=e.map(e=>({...e,selected:!1}));return s=[g,...t]}),{edges:d,nodes:s,sourceId:g.id}});x.debugLabel="addParentNodeAtom";let E=(0,a.cn)(null,(e,t,n)=>{let r=e(f.K),a=e(y),l=n.reduce((e,t)=>("dimensions"===t.type&&r.find(e=>e.id===t.id&&"zap"===e.type)&&e.push(t.id),e),[]);0!==l.length&&l.forEach(e=>{let l=r.find(t=>t.id===e);if(l){let i=n.find(t=>t.id===e);if(i&&i.dimensions){let{dimensions:{height:n}}=i,o=(0,b.xA)(l,r,a),u=o.filter(e=>"zapStep"===e.type),s=0===u.length?null:u[0];if(s){let r=n+50-s.position.y;0!==r&&t(f.K,t=>t.map(t=>"zapStep"===t.type&&t.parentNode===e?{...t,position:{x:t.position.x,y:t.position.y+r}}:t))}}}})});E.debugLabel="adjustZapStepsPositionAtom";let N=(0,a.cn)(e=>{let t=e(y);return t.every(e=>!e.selected)});N.debugLabel="areAllEdgesDeselectedAtom";let v=(0,a.cn)(e=>{let t=e(f.K);return t.every(e=>!e.selected)});v.debugLabel="areAllNodesDeselectedAtom";var P=n(44465);let z=["group","text","comment","zapStep"],$=(0,a.cn)({id:"",name:"",full_name:"",photo_url:"",nodes:[],edges:[],lastchanged:null,created:null,description:null,is_shared_with_account:!1,customuser_id:null});$.debugLabel="canvasAtom";let j=(0,a.cn)(e=>e($).name);j.debugLabel="canvasNameAtom";let K=(0,a.cn)(e=>e($).id);K.debugLabel="canvasIdAtom";let k=(0,a.cn)([]);k.debugLabel="pastAtom";let _=(0,a.cn)([]);_.debugLabel="futureAtom";let F=(0,a.cn)(null,(e,t)=>{let n=e(f.K).filter(e=>e.type!==r.L8),a=e(y).filter(e=>e.className!==r.L8);t(k,e=>[...e.slice(e.length-100+1,e.length),{nodes:n,edges:a}]),t(_,[])});F.debugLabel="takeSnapshotAtom";let D=(0,a.cn)(null,(e,t)=>{let n=e(k),r=n[n.length-1],a=e(f.K),l=e(y),i=e($);return r?(t(k,e=>e.slice(0,e.length-1)),t(_,e=>[...e,{nodes:a,edges:l}]),t(f.K,r.nodes),t(y,r.edges),{nodes:r.nodes,edges:r.edges,id:i.id}):null});D.debugLabel="undoAtom";let Z=(0,a.cn)(null,(e,t)=>{let n=e(_),r=n[n.length-1],a=e(f.K),l=e(y),i=e($);return r?(t(_,e=>e.slice(0,e.length-1)),t(k,e=>[...e,{nodes:a,edges:l}]),t(f.K,r.nodes),t(y,r.edges),{nodes:r.nodes,edges:r.edges,id:i.id}):null});Z.debugLabel="redoAtom";let C=(0,S.xu)(e=>{let t=(0,a.cn)(t=>{let n=t(f.K);return n.filter(t=>"zapStep"===t.type&&t.parentNode===e&&!0!==t.hidden).map(e=>({...e,position:getAbsoluteNodePosition(e,n)}))});return t.debugLabel=`zapStepNodesVisibleAtom(${e})`,t}),I=(0,a.cn)(null,(e,t)=>{t(F);let n=new P.graphlib.Graph;n.setGraph({rankdir:"LR",ranksep:120,nodesep:80}),n.setDefaultEdgeLabel(()=>({}));let a=e(y).filter(e=>"zapStepEdge"!==e.type),l=e(f.K),i=l.filter(e=>!z.includes(e.type));function calcNodeHeight(t){if("zap"===t.type){let n=e(C(t.id)),r=(0,b.RX)([t,...n]);return r.height}return t.height??r.$j}i.forEach(e=>{n.setNode(e.id,{width:e.width??r.DU,height:calcNodeHeight(e)})}),a.forEach(e=>{n.setEdge(e.source,e.target)}),(0,P.layout)(n);let o=l.map(e=>{let t=n.node(e.id),r="path"===e.type?-66:0;return t?{...e,position:{x:t.x-t.width/2+r,y:t.y-t.height/2}}:e});return t(f.K,o),{nodes:o,isSuccess:!0}});I.debugLabel="autoLayoutAtom";var M=n(60629);let O=(0,a.cn)(null,(e,t)=>{let n=e(M.m).filter(e=>!z.includes(e.type));if(0===n.length)return{isSuccess:!1,nodes:[]};t(F);let a=n[0].position,l=e(f.K),i=e(y).filter(e=>"zapStepEdge"!==e.type),o=new P.graphlib.Graph().setGraph({rankdir:"LR",ranksep:120,nodesep:80}).setDefaultEdgeLabel(()=>({}));function calcNodeHeight(t){if("zap"===t.type){let n=e(C(t.id)),r=(0,b.RX)([t,...n]);return r.height}return t.height??r.$j}n.forEach(e=>{o.setNode(e.id,{width:e.width??r.DU,height:calcNodeHeight(e)})}),(0,b.my)(n,i).forEach(e=>{o.hasNode(e.source)&&o.hasNode(e.target)&&o.setEdge(e.source,e.target)}),(0,P.layout)(o);let u=l.map(e=>{let t=o.node(e.id),n="path"===e.type?-66:0;return t?{...e,position:{x:t.x-t.width/2+n,y:t.y-t.height/2}}:e}),s=u.find(e=>e.id===n[0].id).position,d=a.x-s.x,c=a.y-s.y,p=u.map(e=>{let t=n.find(t=>t.id===e.id);return t?{...e,position:{x:e.position.x+d,y:e.position.y+c}}:e});return t(f.K,p),{nodes:p,isSuccess:!0}});O.debugLabel="autoLayoutSelectedNodesAtom";let T=(0,a.cn)(null,async(e,t,n)=>{let r=e($);if(!r.id)return;let a=Object.fromEntries(Object.entries(n).filter(e=>{let[t,n]=e;return null!==n||void 0!==n}));await fetch(`/api/canvas/v1/canvases/${r.id}/`,{method:"PATCH",headers:{"Content-type":"application/json","trailing-slash-hack":"true"},body:JSON.stringify({...a})}),t($,e=>({...e,...n}))});T.debugLabel="canvasAtomWriteOnly";let B=(0,S.xu)(e=>{let t=(0,a.cn)(t=>{let n=t(y);return n.filter(t=>t.source===e)});return t.debugLabel=`childrenEdgesAtomFamily(${e})`,t}),H=(0,a.cn)(!1),W=(0,a.cn)(async e=>{let t=e(H);if(!t)return null;let n=await fetch("/api/canvasui/interfaces",{method:"POST"});if(!n.ok){let e=await n.json();throw Error(e.error)}return await n.json()});W.debugLabel="createNewInterfaceAsyncAtom";let R=(0,a.cn)(e=>{let{name:t}=e($);return t?`${t} (created by Canvas)`:"Created by Canvas"});R.debugLabel="newAssetNameAtom";let U=(0,a.cn)(!1);U.debugLabel="shouldCreateNewTableAtom";let V=(0,a.cn)(async e=>{let t=e(U);if(!t)return null;let n=e(R),r=await fetch("/api/canvasui/tables",{method:"POST",body:JSON.stringify({name:n})});if(!r.ok){let e=await r.json();throw Error(e.error)}return await r.json()});V.debugLabel="createNewTableAsyncAtom";let G=(0,a.cn)("select");function getNodeIdsToBeDeleted(e){return e.filter(t=>{if("zapStep"===t.type&&t.parentNode){let n=e.find(e=>e.id===t.parentNode);return n&&!n.data.zapId}return!1}).map(e=>e.id)}G.debugLabel="cursorAtom";let J=(0,a.cn)(null,(e,t)=>{let n=e(f.K),r=e(y),a=getNodeIdsToBeDeleted(n),l=n.filter(e=>!a.includes(e.id)),i=r.filter(e=>!a.includes(e.source)&&!a.includes(e.target));t(f.K,l),t(y,i)});function buildHierarchy(e,t){let n=new Map(e.map(e=>[e.id,{...e,children:[]}]));return t.forEach(e=>{let t=n.get(e.source),r=n.get(e.target);t&&r&&t.children?.push(r)}),n}J.debugLabel="deleteZapStepNodesAndEdgesAtom";var Y=n(40532);function getHierarchyFromNode(e,t){let n=t.get(e);return(0,Y.ZP)(n)}let X=(0,S.xu)(e=>{let t=(0,a.cn)(t=>{let n=t(f.K),r=t(y),a=buildHierarchy(n,r),l=getHierarchyFromNode(e,a);return l.descendants().filter(t=>void 0!==t.data&&t.data.id!==e).map(e=>e.data)});return t.debugLabel=`visibleDescendantsAtomFamily(${e})`,t}),q=(0,a.cn)(null,(e,t,n)=>{let a=e(X(n)),l=e(f.K),i=a.filter(e=>"zapStep"!==e.type).map(e=>e.id),o=l.map(e=>i.includes(e.id)?{...e,position:{x:e.position.x+r.Dz,y:e.position.y}}:e);return t(f.K,o),o});q.debugLabel="updateDescendantPositionsAtom";let Q=(0,a.cn)(null,(e,t)=>{let n=e(N);if(n)return;let r=e(y),a=r.map(e=>e.selected?{...e,selected:!1}:e);t(y,a)});Q.debugLabel="deselectAllEdgesAtom";let ee=(0,a.cn)(null,(e,t)=>{let n=e(v);if(n)return;let r=e(f.K),a=r.map(e=>e.selected?{...e,selected:!1}:e);t(f.K,a)});ee.debugLabel="deselectAllNodesAtom";let et=(0,S.xu)(e=>{let t=(0,a.cn)(t=>{let n=t(f.K),r=n.find(t=>t.id===e);if(!r)return{width:0,height:0};let a=n.filter(e=>r.data.nodes.includes(e.id)),l=(0,b.RX)(a);return{minWidth:l.width+50,minHeight:l.height+50+4}});return t.debugLabel=`groupNodeDimensionsAtomFamily(${e})`,t}),en=(0,a.cn)(e=>{let t=e(f.K);return t.some(e=>"group"===e.type)});en.debugLabel="haveGroupNodesAtom";let er=(0,a.cn)(null,(e,t,n)=>{let r=e(f.K),a=r.map(e=>({...e,selected:!1})),l=[...a,n];return t(f.K,l),l});function atomWithRefresh(e){let t=(0,a.cn)(0);return t.debugLabel="refreshCounter",(0,a.cn)(n=>(n(t),e(n)),(e,n)=>n(t,e=>e+1))}er.debugLabel="addNodeAtom";let ea=atomWithRefresh(async()=>{let e=await fetch("/api/canvasui/interfaces");if(!e.ok){let t=await e.json();throw Error(t.error)}let t=await e.json();return t});ea.debugLabel="interfacesUsageAtom";let el=(0,a.cn)(!1);el.debugLabel="isCommentUpsellVisibleAtom";let ei=(0,a.cn)(!1);ei.debugLabel="isDeleteCanvasModalOpenAtom";let eo=(0,a.cn)(!1);eo.debugLabel="isDraggingNodeAtom";let eu=(0,a.cn)(!1);eu.debugLabel="isKeyboardShortcutsModalOpenAtom";let es=(0,S.xu)(e=>{let t=(0,a.cn)(t=>{let n=t(M.m);return 1!==n.length&&n.some(t=>{let{id:n}=t;return n===e})});return t.debugLabel=`isMultiSelectedAtomFamily(${e})`,t}),ed=(0,a.cn)(null);ed.debugLabel="newAssetIdentifierAtom";let ec=(0,a.cn)(async e=>{let t=e(K),n=await fetch(`/api/v1/assets?ids=${t}&asset_type=canvas`);if(!n.ok){let e=await n.json();throw Error(e.error)}let r=await n.json();return 0===r.results.length?null:r.results[0].project});ec.debugLabel="projectAsyncAtom";let ep=atomWithRefresh(async e=>{try{let t=await e(ec);if(!t)return{assets:null};let n=await fetch(`/api/v1/projects/${t.id}/assets`);if(!n.ok){let e=await n.json();return{project:t,error:e.error||"Unknown error",status:n.status,permissionDenied:403===n.status,assets:null}}let r=await n.json(),a=r.results.reduce((e,t)=>("canvas"===t.asset_type||(e[t.asset_type]||(e[t.asset_type]=[]),e[t.asset_type].push(t)),e),{});return{assets:a,project:t}}catch(e){return console.error("Error fetching project or assets:",e),{error:e instanceof Error?e.message:String(e),status:500,permissionDenied:!1,assets:null}}});ep.debugLabel="projectAssetsAsyncAtom";let ef=(0,a.cn)(async e=>{let t=e(ed);if(!t)return;let[n,r]=t.split(":"),a=Number(r),l=await e(ep);if(l?.assets){let e=l.assets;if(Object.prototype.hasOwnProperty.call(e,n))return e[n].some(e=>e.node_id===a)}});ef.debugLabel="isAssetInProjectAsyncAtom";let eg=(0,S.xu)(e=>{let t=(0,a.cn)(t=>{if(!e)return!1;let n=t(v),r=t(e$);return n&&1===r.length&&r[0].id===e});return t.debugLabel=`isOnlyEdgeSelectedAtomFamily(${e})`,t}),em=(0,S.xu)(e=>{let t=(0,a.cn)(t=>{let n=t(eo);if(n)return!1;let r=t(M.m);return 1===r.length&&r[0].id===e});return t.debugLabel=`isOnlyNodeSelectedAtomFamily(${e})`,t}),eb=(0,a.cn)(!1);eb.debugLabel="isEditDescriptionModalOpenAtom";let eh=(0,a.cn)(void 0);eh.debugLabel="templateAtom";let ey=(0,a.cn)(!1);ey.debugLabel="isPublicAtom";let eA=(0,a.cn)(e=>{let t=e(en),n=e(eh),r=e(ey);return t||!!n||r});eA.debugLabel="isViewOnlyModeAtom";let eL=(0,S.xu)(e=>{let t=(0,a.cn)(t=>{let n=t(f.K),r=t(y),a=r.filter(t=>t.source===e).map(e=>e.target),l=a.reduce((e,t)=>{let r=n.find(e=>e.id===t);return r&&e.push(r),e},[]);if(0===l.length)return{x:0,y:0};let i=l.reduce((e,t)=>t.position.y>e.position.y?t:e,l[0]);return i.position});return t.debugLabel=`lastBranchingPathPositionAtomFamily(${e})`,t}),eS=(0,a.cn)({});eS.debugLabel="initiatedFetchMembersAtom";let ew=(0,a.cn)({});ew.debugLabel="membersAtom";let ex=(0,a.cn)(e=>e(ew));ex.debugLabel="membersAtomReadOnly";let eE=(0,a.cn)(null,async(e,t,n)=>{let r=e(ex),a=e(eS),l=n.filter(e=>!r[e]&&!a[e]);if(0===l.length)return;let i={...a};l.forEach(e=>{i[e]=!0}),t(eS,i);let o=e(u),fetchMembersAsync=async()=>{let e=await fetch(`/api/v4/accounts/${o}/members?ids=${l.join(",")}`),n=await e.json(),r=n.results.reduce((e,t)=>(e[t.id]=t,e),{});t(ew,e=>({...e,...r}))};await fetchMembersAsync()});eE.debugLabel="fetchAndSetMembersAtom";let eN=(0,a.cn)(null);eN.debugLabel="nodeIdToFocusAppSearch";let ev=(0,S.xu)(e=>{let{customuser_id:t}=e,n=(0,a.cn)(async e=>{let n=e(u);if(!n)return null;let r=await fetch(`/api/v4/accounts/${n}/members/${t}`);return await r.json()});return n.debugLabel="ownerAsyncAtomFamily",n},(e,t)=>e.customuser_id===t.customuser_id),eP=(0,a.cn)({});eP.debugLabel="zapsAtom";let ez=(0,a.cn)(async e=>{let t=await e(ep);if("error"in t||null===t.assets)return t;let n=e(u),r={...t.assets},a={zap:[],interface:[],table:[],chatbot:[]};if(r.zap&&r.zap.length>0){let t=e(eP),l=r.zap.map(async e=>{let r=t[e.node_id];if(r)return r;try{let t=await fetch(`/api/gulliver/storage/v1/zaps/${e.node_id}?account_id=${n}`);if(!t.ok)throw Error("Fetch failed");let r=await t.json();return r}catch(t){return console.error(`Failed to fetch Zap ${e.node_id}:`,t),null}}),i=await Promise.all(l);a.zap=i.filter(e=>null!==e)}return{assets:a,project:t.project}});ez.debugLabel="projectAssetsHydratedAsyncAtom";let e$=(0,a.cn)(e=>e(y).filter(e=>e.selected));e$.debugLabel="selectedEdgesAtom";let ej=(0,a.cn)(null);ej.debugLabel="selectedNodeTypeAtom";let eK=(0,a.cn)(null);eK.debugLabel="selectedAssetIdAtom";let ek=(0,a.cn)(null,(e,t,n)=>{let r=e(f.K),a=r.map(e=>({...e,selected:e.id===n}));t(f.K,a)});async function getImplementations(e){let t=[...new Set(e)].filter(Boolean);if(0===t.length)return[];let n=new URLSearchParams({global:"true",limit:t.length.toString(),selected_apis:t.join(",")}),r=await fetch(`/api/v4/implementations/?${n.toString()}`);if(!r.ok)throw Error("Failed to fetch implementations data");let a=await r.json();return a.results}ek.debugLabel="selectSingleNodeAtom";let e_=(0,a.cn)([]);e_.debugLabel="selectedAppsAtom";let eF=(0,a.cn)([]);eF.debugLabel="recommendationAppsAtom";let eD=(0,a.cn)([]);eD.debugLabel="servicesAtom";let eZ=(0,a.cn)(e=>e(eD));eZ.debugLabel="servicesAtomReadOnly";let eC=(0,a.cn)(null,async(e,t)=>{let n=e(e_),r=e(eF),a=e(eD),l=[...n,...r].filter(e=>!a.some(t=>t.selected_api===e));if(l.length>0){let e=await getImplementations(l);t(eD,t=>{let n=new Map(t.map(e=>[e.selected_api,e]));for(let t of e)n.has(t.selected_api)||n.set(t.selected_api,t);return Array.from(n.values())})}});eC.debugLabel="servicesAtomWriteOnly";let eI=(0,S.xu)(e=>{let t=(0,a.cn)(t=>{let n=t(eZ);return n.find(t=>t.selected_api===e)});return t.debugLabel=`serviceAtomFamily(${e})`,t}),eM=(0,a.cn)(null,(e,t,n)=>{let a=e(y),l=a.filter(e=>e.className!==r.L8);n&&!l.find(e=>e.source===n.source&&e.target===n.target)&&l.push({...n,className:r.L8}),t(y,l)});eM.debugLabel="setTempEdgeAtom";let eO=(0,a.cn)(e=>{let t=e(G),n=!!e(eh),r=e(en);return"connect"!==t&&!n&&!r});eO.debugLabel="shouldShowAddStepButtonAtom";let eT=(0,a.cn)(!1);eT.debugLabel="shouldShowStepIdsAtom";var eB=n(45748);let eH=atomWithRefresh(async()=>{let e=await fetch("/api/canvasui/tables");if(!e.ok){let t=await e.json();throw Error(t.error)}return await e.json()});eH.debugLabel="tablesUsageAsyncAtom";let eW=asyncAtomWithStorage(async()=>{try{let e=await fetch("/api/canvasui/toggles");return e.json()}catch(e){return{interfaceEmbed:!1,useLiveblocks:!1,useFgaAccount:!1,useLiveblocksThreads:!1,usePublicLinkSharing:!1,manageProjectsMvp:!1}}});function getLayoutedZapStepsAndEdges(e,t,n){e.forEach(e=>{n.setNode(e.id,{width:r.DU,height:r.ky})}),t.forEach(e=>{n.setEdge(e.source,e.target)}),(0,P.layout)(n);let a=n.node(e[0].id),l=e.map(e=>{let t=n.node(e.id);return{...e,targetPosition:b.Ly.Top,sourcePosition:b.Ly.Bottom,position:{x:t.x-a.x,y:t.y-r.ky/2}}});return{nodes:l,edges:t}}function layoutElementsVertically(e){let{zapNode:t,zapSteps:n,zapStepEdges:a}=e,l=new P.graphlib.Graph;l.setGraph({rankdir:"TB"}),l.setDefaultEdgeLabel(()=>({})),l.setNode(t.id,{width:r.DU,height:t.height??r.$j});let{nodes:i,edges:o}=getLayoutedZapStepsAndEdges(n,a,l);return{layoutedZapSteps:i,layoutedZapStepEdges:o}}eW.debugLabel="togglesAtom";let getChildSteps=(e,t)=>{for(let n of e)t.set(n.id,n),n.steps&&getChildSteps(n.steps,t)};function getAllStepsFlat(e){let t=new Map;return getChildSteps(e,t),Array.from(t.values())}function isPathBranchStep(e){return"EngineAPI"===e.app&&"series_skip_errors"===e.action&&"run"===e.type}function getAllVisibleStepsFlat(e){let t=getAllStepsFlat(e);return t.filter(e=>!isPathBranchStep(e))}function isPathRulesStep(e){return"BranchingAPI"===e.app&&"filter"===e.action}let createParentMap=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";e.forEach(e=>{n&&t.set(e.id,n),e.steps&&createParentMap(e.steps,t,e.id)})},findPathParent=(e,t,n)=>{let r=n.get(e);if(!r)return null;let a=t.find(e=>e.id===r);return a?"parallel_paths"===a.action&&"BranchingAPI"===a.app?a:findPathParent(r,t,n)||a:null},findPathParentForVisibleSteps=e=>{let t=getAllStepsFlat(e),n=getAllVisibleStepsFlat(e),r=new Map;return createParentMap(t,r),n.map(e=>{let n=isPathRulesStep(e);return{...e,pathParentId:n?findPathParent(e.id,t,r)?.id:null}})},eR=(0,S.xu)(e=>{let t=(0,a.cn)(t=>{let n=t(f.K),a=t(eP),l=n.find(t=>t.id===e),i=l.data.zapId,o=a[i]??{},{draft:u,current_version:s}=o,d=!!s,c=s?.zdl??u?.zdl,p=c?.steps??[],g=findPathParentForVisibleSteps(p),m=g.map((e,t)=>({type:"zapStep",id:`zap-${l.id}-${e.id}`,data:{stepNumber:t+1,step:e,isZapPublished:d},position:{x:0,y:0},width:r.DU,height:r.ky,parentNode:l.id,selectable:!0,deletable:!1,draggable:!1,connectable:d})),b=m.map((e,t)=>{let n=e.data.step.pathParentId,r=`zap-${l.id}-${n}`,a=0===t?e.parentNode:n?r:m[t-1].id,i=e.id;return{id:`${a}=>${i}`,type:"zapStepEdge",source:a,target:i,sourceHandle:0===t?"zap-node-bottom-handle":"zap-step-bottom-handle",targetHandle:"zap-step-top-handle",deletable:!1,focusable:!1,animated:!0}}),h=m.map(e=>e.id),y=b.map(e=>e.id);return{nodes:m,edges:b,nodeIDs:h,edgeIDs:y}});return t.debugLabel=`zapStepsByIdAtomFamily(${e})`,t});function isNotZapNodeOrZapStep(e,t){return"zapStep"!==e.type&&e.id!==t}function hasConnections(e,t,n){let r=(0,b.vG)(e,t,n),a=(0,b.xA)(e,t,n),l=r.filter(t=>isNotZapNodeOrZapStep(t,e.parentNode)),i=a.filter(t=>isNotZapNodeOrZapStep(t,e.parentNode));return[...l,...i].length>0}function createNewEdgesForConnectedZapSteps(e,t){return e.map((n,r)=>{let a=0===r?t:e[r-1].id,l=n.id,{stepNumber:i}=n.data,o=0===r?i-1:i-e[r-1].data.stepNumber-1,u=0===o?void 0:`+${o}`;return{id:`${a}=>${l}`,type:"zapStepEdge",source:a,target:l,sourceHandle:0===r?"zap-node-bottom-handle":"zap-step-bottom-handle",targetHandle:"zap-step-top-handle",deletable:!1,focusable:!1,animated:!0,data:{label:u}}})}function createCollapsedZapStepAndEdges(e){let{zapNodeId:t,zapSteps:n,nodes:r,edges:a}=e,l=n.filter(e=>hasConnections(e,r,a)),i=l.map(e=>e.id),o=createNewEdgesForConnectedZapSteps(l,t),u=o.map(e=>e.id);return{zapStepsWithConnections:l,zapStepEdges:o,zapStepsWithConnectionsId:i,zapStepEdgesId:u}}function dropInvalidEdges(e,t,n){let r=t.map(e=>e.id),a=`zap-${e}`,l=n.filter(e=>e.source.includes(a)&&!r.includes(e.source)||e.target.includes(a)&&!r.includes(e.target));return n.filter(e=>!l.includes(e))}let eU=(0,a.cn)({});eU.debugLabel="zapStepsDataMapAtom";let eV=(0,S.xu)(e=>{let t=(0,a.cn)(t=>t(f.K).filter(t=>"zapStep"===t.type&&t.parentNode===e),(t,n)=>{let r=t(f.K),a=t(y),l=r.find(t=>t.id===e),i=l?.data.isExpanded,o=[],u=[],s={},{nodes:d,edges:c}=t(eR(e)),p=d.filter(e=>!r.some(t=>t.id===e.id)),g=c.filter(e=>!a.some(t=>t.id===e.id));if(p.length>0&&g.length>0){let{layoutedZapSteps:t,layoutedZapStepEdges:n}=layoutElementsVertically({zapNode:l,zapSteps:p,zapStepEdges:g}),r=t.map(e=>e.id),a=n.map(e=>e.id);s[e]={layoutedAllZapSteps:t,layoutedAllZapStepEdges:n,layoutedAllZapStepsIds:r,layoutedAllZapStepEdgesIds:a},o.push(...t),u.push(...n)}if(o.length>0&&u.length>0){let t=[...r,...o.map(e=>({...e,hidden:!i}))],d=dropInvalidEdges(e,o,a),c=[...d,...u.map(e=>({...e,hidden:!i}))],{zapStepsWithConnections:p,zapStepEdges:g}=createCollapsedZapStepAndEdges({zapNodeId:e,zapSteps:o,nodes:r,edges:a});if(!i&&p.length>0){let{layoutedZapSteps:e,layoutedZapStepEdges:n}=layoutElementsVertically({zapNode:l,zapSteps:p,zapStepEdges:g}),r=new Map(e.map(e=>[e.id,e]));t=t.map(e=>{let t=r.get(e.id);return t||e});let a=new Map(n.map(e=>[e.id,e])),i=[...c,...n],o=new Set(i.map(e=>e.id)),u=[...o];c=u.map(e=>{let t=a.get(e);return t||c.find(t=>t.id===e)})}n(f.K,t),n(y,c),n(eU,e=>({...e,...s}))}});return t.debugLabel=`zapStepNodesAtomFamily(${e})`,t}),eG=(0,S.xu)(e=>{let t=(0,a.cn)(t=>{let n=t(f.K),r=t(y),a=t(eV(e)),{zapStepsWithConnections:l,zapStepEdges:i}=createCollapsedZapStepAndEdges({zapNodeId:e,zapSteps:a,nodes:n,edges:r});return{collapsedZapSteps:l,collapsedZapStepEdges:i}});return t.debugLabel=`zapStepsWithConnectionsAtomFamily(${e})`,t});function removeZapStepEdges(e,t){return e.filter(e=>!("zapStepEdge"===e.type&&(t.includes(e.source)||t.includes(e.target))))}let eJ=(0,S.xu)(e=>{let t=(0,a.cn)(null,(t,n,r)=>{let a=t(f.K),l=t(eU),{layoutedAllZapSteps:i,layoutedAllZapStepsIds:o,layoutedAllZapStepEdges:u}=l[e],s=new Map(i.map(e=>[e.id,e])),{collapsedZapSteps:d,collapsedZapStepEdges:c}=t(eG(e)),p=a.find(t=>t.id===e);if(r){if(0===d.length)n(f.K,t=>t.map(t=>{let n=s.get(t.id);return n?{...n,hidden:!0}:t.id===e?{...t,data:{...t.data,isExpanded:!r}}:t})),n(y,e=>[...removeZapStepEdges(e,o),...u.map(e=>({...e,hidden:!0}))]);else{let{layoutedZapSteps:t,layoutedZapStepEdges:a}=layoutElementsVertically({zapNode:p,zapSteps:d,zapStepEdges:c}),l=new Map(t.map(e=>[e.id,e]));n(f.K,t=>t.map(t=>{let n=l.get(t.id);return n||(o.includes(t.id)?{...t,hidden:!0}:t.id===e?{...t,data:{...t.data,isExpanded:!r}}:t)})),n(y,e=>[...removeZapStepEdges(e,o),...a])}}else n(f.K,t=>t.map(t=>{let n=s.get(t.id);return n||(t.id===e?{...t,data:{...t.data,isExpanded:!r}}:t)})),n(y,e=>[...removeZapStepEdges(e,o),...u])});return t.debugLabel=`toggleZapStepNodesAndEdgesAtomFamily(${e})`,t}),eY=(0,a.cn)(null),eX=(0,a.cn)(null),eq=(0,a.cn)(null,(e,t,n)=>{let r=n.id,a=e(f.K),l=a.map(e=>(e.id===r&&(e={...e,...n,data:{...e.data,...n.data}}),e));return t(f.K,l),l});eq.debugLabel="updateNodeAtom";let eQ=(0,a.cn)(e=>{let t=e(f.K);return t.filter(e=>!0!==e.hidden)});eQ.debugLabel="visibleNodesAtom";let e0=(0,S.xu)(e=>{let t=(0,a.cn)(t=>t(eP)[e||""]);return t.debugLabel=`zapAtomFamily(${e})`,t})},71287:function(e,t,n){n.d(t,{K:function(){return a}});var r=n(54337);let a=(0,r.cn)([]);a.debugLabel="nodesAtom"},60629:function(e,t,n){n.d(t,{m:function(){return l}});var r=n(54337),a=n(71287);let l=(0,r.cn)(e=>{let t=e(a.K);return t.filter(e=>e.selected)});l.debugLabel="selectedNodesAtom"},45748:function(e,t,n){n.d(t,{ED:function(){return a},Yh:function(){return i},yM:function(){return l}});var r=n(54337);let a="summary",l="project",i=(0,r.cn)(null);i.debugLabel="sideBarSelectedAtom"}}]);
//# sourceMappingURL=2144-a74863b70c0e91af.js.map